<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>THE_JETSONS_BOOTCAMP ‚Äì M√≥dulo 2</title>
  <link rel="stylesheet" href="assets/css/style.css" />
</head>
<body class="module2-body">
  <div class="module2-container">
    <h1>M√≥dulo 2 ‚Äì Privacidade e Rastreamento</h1>
    <p style="text-align:center; color: var(--accent-light); margin-bottom:1rem;">
      Avalie IPs (IPv4 ou IPv6), hash e cite sinais de phishing.<br>
      Cada passo vale pontos (1‚Äì10). Ranking local e envio ao backend.<br>
      NOVA TENTATIVA N√ÉO √â PERMITIDA.
    </p>

    <form id="formModulo2">
      <!-- 1) N√∫mero de Identifica√ß√£o -->
      <label for="userId2">1. N√∫mero de Identifica√ß√£o (1‚Äì50):</label>
      <input type="number" id="userId2" name="userId2" min="1" max="50" required />
      <div id="errorUser2" class="error"></div>

      <!-- 2) IP sem VPN -->
      <label for="ipNormal2">2. IP atual sem VPN:</label>
      <input type="text" id="ipNormal2" name="ipNormal2"
             placeholder="Ex: 192.168.1.10 ou fe80::1ff:fe23:4567:890a" required />
      <div id="errorIpNorm2" class="error"></div>

      <!-- 3) IP com VPN -->
      <label for="ipVpn2">3. IP ao usar VPN:</label>
      <input type="text" id="ipVpn2" name="ipVpn2"
             placeholder="Ex: 10.8.0.5 ou 2001:4860:4860::8888" required />
      <div id="errorIpVpn2" class="error"></div>

      <!-- 4) IP com Tor -->
      <label for="ipTor2">4. IP usando Tor:</label>
      <input type="text" id="ipTor2" name="ipTor2"
             placeholder="Ex: 185.220.101.1 ou 2606:4700:4700::1111" required />
      <div id="errorIpTor2" class="error"></div>

      <!-- 5) Hash SHA256 -->
      <label for="hashFile2">5. Hash SHA256 do arquivo:</label>
      <input type="text" id="hashFile2" name="hashFile2"
             placeholder="Ex: 3a7d‚Ä¶f5b9 (64 hex)" required />
      <div id="errorHash2" class="error"></div>

      <!-- 6) Sinais de Phishing -->
      <label for="phishingDetect2">
        6. Cite 2 sinais de phishing (separe por v√≠rgulas):
      </label>
      <textarea id="phishingDetect2" name="phishingDetect2" rows="3"
                placeholder="Ex: URL suspeita, pedido urgente de senha"
                required></textarea>
      <div id="errorPhishing2" class="error"></div>

      <button type="button" id="btnEnviar2" onclick="avaliarModulo2()">Enviar e Ver Resultado</button>
    </form>

    <!-- Exibi√ß√£o de nota e ranking -->
    <div id="resultadoModulo2"></div>
    <div id="rankingModulo2"></div>

    <!-- Bot√£o Voltar ao Menu -->
    <a href="index.html" class="button" style="margin-top:1rem;">‚Ü©Ô∏è Voltar ao Menu</a>
  </div>

  <script>
    // Valida√ß√£o IPv4
    function isIPv4(ip) {
      var partes = ip.split('.');
      if (partes.length !== 4) return false;
      for (var i = 0; i < partes.length; i++) {
        var p = partes[i];
        if (!/^\d+$/.test(p)) return false;
        var num = parseInt(p, 10);
        if (num < 0 || num > 255) return false;
      }
      return true;
    }

    // Valida√ß√£o IPv6 (8 grupos hexadecimais de 1‚Äì4 d√≠gitos separados por ":")
    function isIPv6(ip) {
      var regexIPv6 = /^([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$/;
      return regexIPv6.test(ip);
    }

    // Valida√ß√£o combinada (IPv4 ou IPv6)
    function validaIP(ip) {
      return isIPv4(ip) || isIPv6(ip);
    }

    // Ranking local da sess√£o (at√© 10)
    var rankingLocal2 = [];

    function avaliarModulo2() {
      // Desabilita o bot√£o para impedir nova tentativa
      document.getElementById('btnEnviar2').disabled = true;

      // Limpa erros anteriores
      document.getElementById('errorUser2').textContent = '';
      document.getElementById('errorIpNorm2').textContent = '';
      document.getElementById('errorIpVpn2').textContent = '';
      document.getElementById('errorIpTor2').textContent = '';
      document.getElementById('errorHash2').textContent = '';
      document.getElementById('errorPhishing2').textContent = '';

      var total2 = 0;

      // 1) UserID (1 ponto)
      var user2 = document.getElementById('userId2').value.trim();
      if (!user2 || isNaN(user2) || +user2 < 1 || +user2 > 50) {
        document.getElementById('errorUser2').textContent = 'Informe um n√∫mero entre 1 e 50.';
      } else {
        total2 += 1;
      }

      // 2) IP sem VPN (2 pontos)
      var ipNorm2 = document.getElementById('ipNormal2').value.trim();
      if (!validaIP(ipNorm2)) {
        document.getElementById('errorIpNorm2').textContent =
          'IP inv√°lido (IPv4 ou IPv6 esperado).';
      } else {
        total2 += 2;
      }

      // 3) IP com VPN (2 pontos)
      var ipVpn2 = document.getElementById('ipVpn2').value.trim();
      if (!validaIP(ipVpn2)) {
        document.getElementById('errorIpVpn2').textContent =
          'IP inv√°lido (IPv4 ou IPv6 esperado).';
      } else {
        total2 += 2;
      }

      // 4) IP via Tor (2 pontos)
      var ipTor2 = document.getElementById('ipTor2').value.trim();
      if (!validaIP(ipTor2)) {
        document.getElementById('errorIpTor2').textContent =
          'IP inv√°lido (IPv4 ou IPv6 esperado).';
      } else {
        total2 += 2;
      }

      // 5) Hash SHA256 (1 ponto)
      var hash2 = document.getElementById('hashFile2').value.trim();
      if (!/^[a-f0-9]{64}$/i.test(hash2)) {
        document.getElementById('errorHash2').textContent =
          'Hash SHA256 inv√°lido (64 hexadecimais).';
      } else {
        total2 += 1;
      }

      // 6) Sinais de Phishing (1 ponto; conta itens separados por v√≠rgula)
      var phishing2 = document.getElementById('phishingDetect2').value.trim();
      var itens2 = phishing2.split(',')
        .map(function(s) { return s.trim(); })
        .filter(function(s) { return s !== ''; });
      if (itens2.length < 2) {
        document.getElementById('errorPhishing2').textContent =
          'Informe ao menos 2 sinais, separados por v√≠rgula.';
      } else {
        total2 += 1;
      }

      // 7) B√¥nus de IPs distintos (1 ponto)
      if (
        validaIP(ipNorm2) && validaIP(ipVpn2) && validaIP(ipTor2) &&
        ipNorm2 !== ipVpn2 && ipNorm2 !== ipTor2 && ipVpn2 !== ipTor2
      ) {
        total2 += 1;
      }

      if (total2 > 10) total2 = 10;

      // Exibe resultado ao aluno
      var res2 = document.getElementById('resultadoModulo2');
      res2.innerHTML = `
        <h2>‚úÖ Sua Nota no M√≥dulo 2: ${total2} / 10</h2>
        <ul style="margin-left:1.2rem;">
          <li>1 ponto ‚Äì N√∫mero de chamada v√°lido (1‚Äì50)</li>
          <li>2 pontos ‚Äì IP sem VPN (IPv4 ou IPv6 correto)</li>
          <li>2 pontos ‚Äì IP com VPN (IPv4 ou IPv6 correto)</li>
          <li>2 pontos ‚Äì IP via Tor (IPv4 ou IPv6 correto)</li>
          <li>1 ponto ‚Äì Hash SHA256 v√°lido (64 hexadecimais)</li>
          <li>1 ponto ‚Äì ‚â• 2 sinais de phishing (separados por v√≠rgula)</li>
          <li>1 ponto ‚Äì B√¥nus se todos os 3 IPs forem distintos</li>
        </ul>
      `;

      // Atualiza ranking local (m√°x 10 desta sess√£o)
      rankingLocal2.push({ id: user2, nota: total2 });
      rankingLocal2.sort(function(a, b) { return b.nota - a.nota; });
      if (rankingLocal2.length > 10) rankingLocal2.length = 10;

      var htmlRank = '<h3>üèÜ TOP 10 (Sess√£o Atual)</h3><ul>';
      rankingLocal2.forEach(function(entry) {
        htmlRank += `<li>#${entry.id} ‚Äì ${entry.nota}/10</li>`;
      });
      htmlRank += '</ul>';
      document.getElementById('rankingModulo2').innerHTML = htmlRank;

      // --- ENVIO AO BACKEND (Apps Script) ---
      var URL_DO_WEB_APP =
        "https://script.google.com/macros/s/AKfycbz8EzKpLCoQaJYScfwJZyRFGecWTiREkHI8RXypl4IDG2lc46TVowZwq_-0qzPmvpSAeA/exec";

      var payload2 = {
        modulo: 'M√≥dulo 2',
        userId: user2,
        ipNormal: ipNorm2,
        ipVpn: ipVpn2,
        ipTor: ipTor2,
        hash: hash2,
        phishing: phishing2,
        nota: total2,
        timestamp: new Date().toISOString()
      };

      fetch(URL_DO_WEB_APP, {
        method: 'POST',
        body: JSON.stringify(payload2)
      }).then(function() {
        console.log('Envio M√≥dulo 2 realizado.');
      }).catch(function(err) {
        console.error('Erro no envio M√≥dulo 2:', err);
      });
    }
  </script>
</body>
</html>
